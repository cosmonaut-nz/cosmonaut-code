{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "FileReview",
    "description": "A source file review data object that captures the elements of the review.",
    "type": "object",
    "properties": {
        "filename": {
            "type": "string",
            "description": "The name of the file as provided"
        },
        "errors": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/error"
            },
            "description": "A list of syntatic or idiomatic errors (not security related) found in the code giving the issue and potential resolution for each. Where the code does not meet language standards, best practice or clearly deviates from DRY or SOLID principles"
        },
        "security_issues": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/securityIssue"
            },
            "description": "A list of security issues, threats or vulnerabilities, such as listed by OWASP, or CVE security vulnerability, etc. Give the threat (and reference, such as listed by OWASP, CVE or any other security frameworks) and mitigation for each"
        },
        "improvements": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/improvement"
            },
            "description": "A list of non-critical code improvements that will improve code quality, readability and maintainability, giving a suggestion and concrete actionable example for each"
        },
        "statistics": {
            "$ref": "#/$defs/languageFileType",
            "description": "A list of statistics (e.g., lines of code, etc.)"
        },
        "file_rag_status": {
            "type": "string",
            "description": "A RAG status for the file according to the findings",
            "enum": [
                "Red",
                "Amber",
                "Green"
            ]
        },
        "summary": {
            "type": "string",
            "description": "A brief and concise summary of what the source file functionally does and of the findings during the code review ensuring that the summary reflects the findings, such as security_issues, errors or improvements."
        }
    },
    "required": [
        "filename",
        "summary"
    ],
    "$defs": {
        "error": {
            "type": "object",
            "properties": {
                "code": {
                    "type": "string",
                    "description": "Where in the code the error was found. Include line of code"
                },
                "issue": {
                    "type": "string",
                    "description": "An error which will directly impact the function or performance of the code. An error is where the code is clearly non-adherent to language standards, best practice or clearly deviates from DRY or SOLID principles."
                },
                "resolution": {
                    "type": "string",
                    "description": "A description of how the error can be resolved the error"
                }
            },
            "required": [
                "code",
                "issue",
                "resolution"
            ]
        },
        "securityIssue": {
            "type": "object",
            "properties": {
                "severity": {
                    "type": "string",
                    "description": "Where the severity strictly aligns to a value found in the Common Vulnerability Scoring System (CVSS), version 3.1.",
                    "enum": [
                        "Low",
                        "Medium",
                        "High",
                        "Critical"
                    ]
                },
                "code": {
                    "type": "string",
                    "description": "Where in the code the issue was found. Include line of code"
                },
                "threat": {
                    "type": "string",
                    "description": "A description of the threat or vulnerability, such as listed by OWASP, or CVE security vulnerability, etc. Detail the implications of the threat."
                },
                "mitigation": {
                    "type": "string",
                    "description": "A description of how the threat can be mitigated"
                }
            },
            "required": [
                "severity",
                "code",
                "threat",
                "mitigation"
            ]
        },
        "improvement": {
            "type": "object",
            "properties": {
                "code": {
                    "type": "string",
                    "description": "Where in the code improvement can be made. Include the line of code as a snippet. Include the line number"
                },
                "suggestion": {
                    "type": "string",
                    "description": "A suggested improvement to the code, why and what can be done"
                },
                "improvement_details": {
                    "type": "string",
                    "description": "Code that will make the improvement. Ensure the code is functionally complete and can be easily implemented in the source file you have reviewed. The code MUST align with the language of the source file"
                }
            },
            "required": [
                "code",
                "suggestion",
                "improvement_details"
            ]
        },
        "languageFileType": {
            "type": "object",
            "properties": {
                "language": {
                    "type": "string",
                    "description": "The language the code is in, e.g., 'Rust', 'C#', 'Java', etc."
                },
                "extension": {
                    "type": "string",
                    "description": "The file extension of the file, e.g., '.rs' or '.cs', etc."
                },
                "percentage": {
                    "type": "number",
                    "description": "A roll-up percentage of all LanguageFileTypes of this language. Leave as zero if not known"
                },
                "size": {
                    "type": "integer",
                    "description": "The size of the file, in bytes. Leave as zero if not known"
                },
                "loc": {
                    "type": "integer",
                    "description": "The number of lines of code found in the file. Excluding comment lines or blocks"
                },
                "total_size": {
                    "type": "integer",
                    "description": "A roll-up of all LanguageFileTypes size values, in bytes. Leave as zero if not known"
                },
                "file_count": {
                    "type": "integer",
                    "description": "A roll-up count of all LanguageFileTypes of this language"
                }
            },
            "required": []
        }
    }
}